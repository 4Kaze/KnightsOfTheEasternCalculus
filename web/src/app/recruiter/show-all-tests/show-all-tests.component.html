<h2 class="mt-4">Dostępne testy</h2>
<table class="table table-hover">
  <thead>
    <tr>
      <th scope="col" width="5%">#</th>
      <th scope="col">Name</th>
      <th scope="col">Author</th>
      <th scope="col">Language</th>
      <th scope="col"></th>
    </tr>
  </thead>
  <ng-container *ngIf="tests; else loading">
    <tbody>
      <tr *ngFor="let test of tests; let i = index" (click)="onSelect(test)" style="cursor: pointer;">
        <th>{{i+1}}</th>
        <th>{{test.title}}</th>
        <th>{{test.amplify-authenticator}}</th>
        <th>{{test.language}}</th>
        <th class="text-right">
          <button class="btn btn-outline-secondary mr-2" (click)="translateTest(test)">Tłumacz</button>
          <button class="btn btn-primary mr-2" [ngbPopover]="assignPopover" triggers="manual"
            popoverTitle="Przypisz kandydata" #p="ngbPopover" autoClose="outside"
            (click)="toggleAssign(p, test.testId, test.title)" popoverClass="assign-popover">Przypisz</button>
          <button class="btn btn-outline-secondary mr-2" (click)="downloadTest(test.testId)">Pobierz</button>
          <button class="btn btn-success mr-2" [routerLink]="['update-test', test.testId]" *ngIf="authService.getUser().getUsername() == test.author">Zmień</button>
          <button class="btn btn-danger" (click)="deleteTest(test)">Usuń</button>
        </th>
      </tr>
    </tbody>
  </ng-container>
</table>
<ng-template #loading>
  <div class="spinner-grow spinner-grow-sm" role="status"></div>
</ng-template>
<div>
  <input type="file" (change)="loadTest($event.target.files)">
  <button class="btn btn-success" (click)="importTest()">Importuj</button>
</div>

<!-- <div class="mt-3">
  <h5>Podgląd pliku</h5>
  <pre> {{fileContent}} </pre>
</div> -->

<ng-template #assignPopover let-id="id" , let-title="title">
  <form class="form-inline">
    <input type="text" class="form-control" id="lastName" placeholder="Nazwisko" [(ngModel)]="searchLastName"
      [ngModelOptions]="{standalone: true}">
    <button type="submit" class="btn btn-primary ml-2" (click)="searchApplicants()">Szukaj</button>
  </form>
  <ng-container *ngIf="applicantLoading || applicants">
    <div class=" mt-2" *ngIf="applicants; else loading">
      <button type="button" class="list-group-item list-group-item-action" *ngFor="let applicant of applicants"
        (click)="openAssignModal(id, title, applicant.id, applicant.firstName, applicant.lastName);">
        {{applicant.firstName}} {{applicant.lastName}} ({{applicant.email}})
      </button>
    </div>
  </ng-container>
</ng-template>
